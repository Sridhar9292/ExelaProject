<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace='com.exelatech.ecxapi.mapper.ACGMapper'>
	<resultMap type='com.exelatech.ecxapi.model.ACGDashboard' id='AcgDashboardResult'>
		<result property='msgId' column='MESSAGEID' />
		<result property='startTime' column='STARTTIME' />
		<result property='endTime' column='ENDTIME' />
		<result property='status' column='STATUS' />
		<result property='msgType' column='MESSAGETYPE' />
		<result property='error' column='ERRORDESCRIPTION' />
	</resultMap>
	
	<resultMap type='com.exelatech.ecxapi.model.ACGPrintRecord' id='ImmedPrintRecord'>
		<result property='appID' column='APPLICATIONID' />
		<result property='prodCode' column='PRODUCTCODE' />
		<result property='funCode' column='FUNCTIONCODE' />
		<result property='docCode' column='DOCCODE' />
		<result property='fName' column='PNIFIRSTNAME' />
		<result property='lName' column='PNILASTNAME' />
		<result property='mName' column='PNIMIDDLENAME' />
		<result property='status' column='STATUS' />
		<result property='respCode' column='RESPONSECODE' />
		<result property='respDesc' column='RESPONSEDESCRIPTION' />
		<result property='errDesc' column='ERRORDESCRIPTION' />
		</resultMap>
	
	<select id="getACGDashBoardInfo" resultMap="AcgDashboardResult">
	SELECT
    eapm.messageid,
    to_char(eapm.starttime,'yyyy-mm-dd hh24:mi:ss') as starttime,
    to_char(eapm.endtime,'yyyy-mm-dd hh24:mi:ss') as endtime,
    eapm.status,
    eapm.messagetype,
    eapm.errordescription
	FROM
    ecx.acg_process_master eapm
	WHERE
    trunc(eapm.starttime) = to_date(#{startDate},'YYYY-MM-DD')
	</select>
	
	<select id="getACGDashboardSuccess" resultMap="AcgDashboardResult">
	SELECT
    eapm.messageid,
    to_char(eapm.starttime,'yyyy-mm-dd hh24:mi:ss') as starttime,
    to_char(eapm.endtime,'yyyy-mm-dd hh24:mi:ss') as endtime,
    eapm.status,
    eapm.messagetype,
    eapm.errordescription
	FROM
    ecx.acg_process_master eapm
	WHERE
   	trunc(eapm.starttime) = to_date(#{stdate},'YYYY-MM-DD') and
    eapm.status = #{status}
	</select>
	
	
	<select id="getACGDashboardIncomplete" resultMap="AcgDashboardResult">
	SELECT
    eapm.messageid,
    to_char(eapm.starttime,'yyyy-mm-dd hh24:mi:ss') as starttime,
    to_char(eapm.endtime,'yyyy-mm-dd hh24:mi:ss') as endtime,
    eapm.status,
    eapm.messagetype,
    eapm.errordescription
	FROM
    ecx.acg_process_master eapm
	WHERE
   	eapm.status = #{status}
   	order by eapm.starttime asc
	</select>
	
	
	<select id="getACGImmediatePrintRecordInlineInfo" resultMap="ImmedPrintRecord">
	SELECT AIPR.APPLICATIONID,AIPR.PRODUCTCODE, AIPR.FUNCTIONCODE,AIPR.DOCCODE,AIPR.PNIFIRSTNAME,AIPR.PNILASTNAME,
	AIPR.PNIMIDDLENAME,AIPR.STATUS,AIPR.ERRORDESCRIPTION,AHSR.RESPONSECODE,AHSR.RESPONSEDESCRIPTION
    FROM ECX.ACG_IMMEDIATE_PRINT_RECORD AIPR, ECX.ACG_HPX_Service_Response AHSR 
    where AIPR.MESSAGEID = #{msgId}
    and AIPR.IMMEDIATEPRINTRECORDID = AHSR.IMMEDIATEPRINTRECORDID(+)
    
	<!-- SELECT PRODUCTCODE, FUNCTIONCODE,DOCCODE,PNIFIRSTNAME,PNILASTNAME,PNIMIDDLENAME,STATUS,
	ERRORDESCRIPTION FROM ECX.ACG_IMMEDIATE_PRINT_RECORD -->
	    <!--  where messageid = #{msgId}-->
     </select>
     
     <select id="getACGMessageErr" resultMap="AcgDashboardResult">

	SELECT
    EAPM.MESSAGEID,
    AEL.EVENTDESCRIPTION as ERRORDESCRIPTION,
    EAPM.STARTTIME AS STARTTIME,
    EAPM.ENDTIME AS ENDTIME,
    EAPM.STATUS AS STATUS,
    EAPM.MESSAGETYPE AS MESSAGETYPE
	FROM
    ECX.ACG_PROCESS_MASTER EAPM,
    Ecx.ACG_EVENT_LOG AEL
    WHERE
	EAPM.MESSAGEID = AEL.MESSAGEID
    and AEL.eventstatus='Failed'
     and EAPM.MESSAGEID = #{messageId}
	</select>
	
</mapper>